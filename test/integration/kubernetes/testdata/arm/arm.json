{
    "apiVersion": "bicep.dev/v1alpha3",
    "kind": "DeploymentTemplate",
    "metadata": {
        "name": "arm",
        "namespace": "arm"
    },
    "spec": {
        "content": {
            "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
            "contentVersion": "1.0.0.0",
            "metadata": {
                "_generator": {
                    "name": "bicep",
                    "version": "0.4.721.5481",
                    "templateHash": "12305972426212226061"
                }
            },
            "functions": [],
            "resources": [
                {
                    "type": "Microsoft.CustomProviders/resourceProviders/Application/HttpRoute",
                    "apiVersion": "2018-09-01-preview",
                    "name": "[format('{0}/{1}/{2}', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'frontendhttp')]",
                    "properties": {
                        "port": 80
                    },
                    "dependsOn": [
                        "[resourceId('Microsoft.CustomProviders/resourceProviders/Application', 'radiusv3', 'kubernetes-resources-container-httpbinding')]"
                    ]
                },
                {
                    "type": "Microsoft.CustomProviders/resourceProviders/Application/ContainerComponent",
                    "apiVersion": "2018-09-01-preview",
                    "name": "[format('{0}/{1}/{2}', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'frontend')]",
                    "properties": {
                        "connections": {
                            "backend": {
                                "kind": "Http",
                                "source": "[resourceId('Microsoft.CustomProviders/resourceProviders/Application/HttpRoute', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'backendhttp')]"
                            }
                        },
                        "container": {
                            "image": "rynowak/frontend:0.5.0-dev",
                            "ports": {
                                "web": {
                                    "containerPort": 80,
                                    "provides": "[resourceId('Microsoft.CustomProviders/resourceProviders/Application/HttpRoute', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'frontendhttp')]"
                                }
                            },
                            "env": {
                                "SERVICE__BACKEND__HOST": "[reference(resourceId('Microsoft.CustomProviders/resourceProviders/Application/HttpRoute', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'backendhttp')).host]",
                                "SERVICE__BACKEND__PORT": "string([reference(resourceId('Microsoft.CustomProviders/resourceProviders/Application/HttpRoute', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'backendhttp')).port])"
                            }
                        }
                    },
                    "dependsOn": [
                        "[resourceId('Microsoft.CustomProviders/resourceProviders/Application', 'radiusv3', 'kubernetes-resources-container-httpbinding')]",
                        "[resourceId('Microsoft.CustomProviders/resourceProviders/Application/HttpRoute', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'backendhttp')]",
                        "[resourceId('Microsoft.CustomProviders/resourceProviders/Application/HttpRoute', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'frontendhttp')]"
                    ]
                },
                {
                    "type": "Microsoft.CustomProviders/resourceProviders/Application/HttpRoute",
                    "apiVersion": "2018-09-01-preview",
                    "name": "[format('{0}/{1}/{2}', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'backendhttp')]",
                    "dependsOn": [
                        "[resourceId('Microsoft.CustomProviders/resourceProviders/Application', 'radiusv3', 'kubernetes-resources-container-httpbinding')]"
                    ]
                },
                {
                    "type": "Microsoft.CustomProviders/resourceProviders/Application/ContainerComponent",
                    "apiVersion": "2018-09-01-preview",
                    "name": "[format('{0}/{1}/{2}', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'backend')]",
                    "properties": {
                        "container": {
                            "image": "rynowak/backend:0.5.0-dev",
                            "ports": {
                                "web": {
                                    "containerPort": 80,
                                    "provides": "[resourceId('Microsoft.CustomProviders/resourceProviders/Application/HttpRoute', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'backendhttp')]"
                                }
                            }
                        }
                    },
                    "dependsOn": [
                        "[resourceId('Microsoft.CustomProviders/resourceProviders/Application', 'radiusv3', 'kubernetes-resources-container-httpbinding')]",
                        "[resourceId('Microsoft.CustomProviders/resourceProviders/Application/HttpRoute', 'radiusv3', 'kubernetes-resources-container-httpbinding', 'backendhttp')]"
                    ]
                },
                {
                    "type": "Microsoft.CustomProviders/resourceProviders/Application",
                    "apiVersion": "2018-09-01-preview",
                    "name": "[format('{0}/{1}', 'radiusv3', 'kubernetes-resources-container-httpbinding')]"
                }
            ]
        }
    }
}
