# Spec Kit – Repo Radius

Modify Radius to support **two modes of operation**, taking inspiration from Terraform and Terraform Cloud:

1. **Control Plane Radius** – the existing centralized Radius control plane.
2. **Repo Radius** – a decentralized mode of Radius that runs as a command-line tool and stores its state in a Git repository.

This specification focuses exclusively on **Repo Radius**.

---

## Repo Radius Overview

Repo Radius is a lightweight, Git-centric mode of Radius designed to run without a centralized control plane. It treats a Git repository as the system of record and is optimized for CI/CD workflows, particularly GitHub Actions.

---

## Execution Model

Repo Radius should:

- Run as a **single executable** on Windows, Linux, and macOS.
- Be installable via native package managers:
  - WinGet (Windows)
  - Homebrew (macOS)
  - `apt` and `dnf` (Linux)
- Not rely on Kubernetes.
  - In the short term, it may run as a short-lived job on a Kind or k3d cluster behind the scenes.
- Be optimized for non-interactive execution in a GitHub Action.
- Expose a command surface similar to the existing `rad` CLI.

---

## CLI Commands

### `rad init`

- Verifies the current working directory is a Git repository.
- Creates the following directory structure:
  - rad/
  - config/
  - model/
  - plan/
  - deploy/
- Directory responsibilities:
  - `rad/config`
    - Contains Radius configuration with friendly defaults (see below).
  - `rad/model`
    - Contains the application model.
    - This model is produced by a separate project.
  - `rad/plan`
    - Contains deployment scripts generated by `rad plan`.
  - `rad/deploy`
    - Contains resource details captured by `rad deploy`.

---

### `rad plan`

- Generates **ready-to-execute deployment scripts** (bash or PowerShell).
- Scripts are derived from the Recipes specified by the Recipe Pack selected in the Environment.
- Scripts may be:
  - Executed by `rad deploy`, or
  - Run directly by the user outside of Radius.
- Initially supported deployment engines:
  - Terraform (plan/apply)
  - Bicep
- Future deployment engines may include:
  - Helm
  - CloudFormation
  - Crossplane
  - Ansible
- Generated deployment artifacts are expected to become part of the Radius application graph in the future.

---

### `rad deploy`

- Executes deployment scripts **only from a Git commit hash or tag**.
- Deploying directly from uncommitted local files is not supported.
- After deployment, captures structured details about the deployed resources in the Git repository, including:
  - The Environment used
  - Cloud platform resource IDs for each deployed resource
  - The full set of properties for each deployed resource as returned by the cloud platform

---

## Configuration Model

All Repo Radius configuration is stored in the Git repository.

### `rad/config`

- **Resource Types**
  - Stored as YAML or TypeSpec files.
- **Environments**
  - Stored as `.env` files.
  - May include:
    - AWS account and region
    - Azure subscription and resource group
    - Kubernetes cluster API endpoint and namespace
    - Selected Recipe Pack
    - Terraform CLI configuration (`terraformrc`)
  - `.env` files must **not** contain credentials.
- **Recipe Packs**
  - Stored in the `rad/config` directory.

---

## Explicit Non-Goals

Repo Radius:

- Does **not** have a concept of Radius Resource Groups.
- Does **not** introduce new commands related to Resource Groups.

---

## Open Questions

Provide guidance on the following outstanding questions:

1. What file format should Recipe Packs use (Bicep, YAML, `key=value`, other)?
2. What features or behaviors would make Repo Radius particularly well-suited for GitHub Actions?
3. What file format should be used to store deployed resource details?