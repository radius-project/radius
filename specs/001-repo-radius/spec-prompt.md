# Spec Kit – Repo Radius

## Prompt

```bash
copilot> /speckit.specify

  Use the following document as the authoritative source.
  - Do not invent new features.
  - Call out ambiguities as open questions.
  - Normalize terminology and requirements language.
 
 <Paste contents below>
```

## Prompt Contents

Modify Radius to support **two modes of operation**, taking inspiration from Terraform and Terraform Cloud:

1. **Control Plane Radius** – the existing centralized Radius control plane.
2. **Repo Radius** – a decentralized mode of Radius that runs as a command-line tool and stores its state in a Git repository.

This specification focuses exclusively on **Repo Radius**.

---

## Repo Radius Overview

Repo Radius is a lightweight, Git-centric mode of Radius designed to run without a centralized control plane. It treats a Git repository as the system of record and is optimized for CI/CD workflows, particularly GitHub Actions.

---

## Execution Model

Repo Radius should:

- Run as a **single executable** on Windows, Linux, and macOS.
- Be installable via native package managers:
  - WinGet (Windows)
  - Homebrew (macOS)
  - `apt` and `dnf` (Linux)
- Not rely on Kubernetes.
  - In the short term, it may run as a short-lived job on a Kind or k3d cluster behind the scenes.
- Be optimized for non-interactive execution in a GitHub Action.
- Expose a command surface similar to the existing `rad` CLI.

---

## Configuration Model

All Repo Radius configuration is stored in the Git repository.

- **Resource Types**
  - Stored in `radius/config/types`
  - Multiple Resource Types stored as YAML or TypeSpec files.
- **Environments**
  - Stored in `radius/config`
  - Stored as `.env` files.
  - Default environment is stored in the `.env` file
  - Other environments are stored in `.env.<ENVIRONMENT_NAME>`
  - May include:
    - AWS account and region
    - Azure subscription and resource group
    - Kubernetes cluster API endpoint and namespace
    - An alternative `recipes.yaml` manifest file
    - Terraform CLI configuration (`terraformrc`)
  - `.env` files must **not** contain credentials.
- **Recipe Packs**
  - Stored as a YAML file in the `radius/config` directory.

---

## CLI Commands

### `rad init`

1. Verifies the current working directory is a Git repository.
1. Creates the following directory structure:
   - `radius/`
     - `config/` – Contains Radius configuration files
     - `model/` - Contains the application model (created by a separate project).
     - `plan/` - Contains deployment scripts generated by `rad plan`.
     - `deploy/` - Contains resource details captured by `rad deploy`.

1. Creates Resource Types in the `radius/config/types` directory from the Radius resource-types-contrib repository
1. Searches the repo for existing `.env` files. If exists, confirms that each `.env` file contains one of:
   - AWS account and region
   - Azure subscription and resource group
   - Kubernetes context name and namespace
   - If a `.env` file does not exist or is insufficient, prompt the user:
     - "Which cloud platform should Radius deploy to? 1. Local only 2. AWS 3. Azure 4. Kubernetes only
     - Dependent upon the response, prompt the user for the `.env` file contents. If AWS or Azure also get Kubernetes details

1. Interactively prompts the user:
   - "When orchestrating application deployments, what deployment tool should Radius use? (T)erraform, (B)icep
   - Create a default `recipes.yaml` in `radius/config/` based on user input

---

### `rad plan`

1. Generates **ready-to-execute deployment scripts** (bash or PowerShell).
   - Scripts are derived from the recipe manifest specified in `.env`.
   - Scripts are not intended to be modified by the user, but is captured for auditability and to be part of the application graph (a separate project)
   - Initially supported deployment engines:
     - Terraform (plan/apply)
     - Bicep
   - Future deployment engines may include:
     - Helm
     - CloudFormation
     - Crossplane
     - Ansible

1. If the deployment engine is Terraform, Radius execute `terrafor plan` and store output in the `radius/plan` directory.

---

### `rad deploy`

1. Radius orchestrates the application deployment by executing the deployment scripts **only from a Git commit hash or tag**.
   - Deploying directly from uncommitted local files is not supported.
1. After deployment, Radius captures structured details about the deployed resources in the Git repository, including:
   - The Environment used
   - Cloud platform resource IDs for each deployed resource
   - The full set of properties for each deployed resource as returned by the cloud platform

---

## Explicit Non-Goals

Repo Radius:

- Does **not** have a concept of Radius Resource Groups.

---

## Open Questions

Provide guidance on the following outstanding questions:

1. What features or behaviors would make Repo Radius particularly well-suited for GitHub Actions?
1. What file format should be used to store deployed resource details?

## Future Enhancements

1. Adapts to existing deployment scripts
   - Examines the Git repository for existing IaC code (*.tf, *.bicep, chart.yaml, kustomize.yaml, template.yaml) and ad

1. Adapts to existing GitOps configurations