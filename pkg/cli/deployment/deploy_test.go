// ------------------------------------------------------------
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.
// ------------------------------------------------------------

package deployment

import (
	"testing"

	"github.com/project-radius/radius/pkg/cli/clients"
	"github.com/project-radius/radius/pkg/corerp/datamodel"
	sdkclients "github.com/project-radius/radius/pkg/sdk/clients"
	"github.com/stretchr/testify/require"
)

//
// <AiDoc: The following comments were generated by OpenAI explaining the code as it existed at the time of this commit>
//	The previous function is creating a ResourceDeploymentClient object and setting the RadiusResourceGroup and Client, 
//	OperationsClient, and AzProvider fields. It then creates an expectedConfig object of type sdkclients.ProviderConfig and 
//	sets the Radius and Deployments fields. Finally, it calls the GetProviderConfigs() function and checks if the returned 
//	providerConfig is equal to the expectedConfig.
//
// </AiDoc: End of OpenAI comments>
func Test_GetProviderConfigs(t *testing.T) {
	resourceDeploymentClient := ResourceDeploymentClient{
		RadiusResourceGroup: "testrg",
	}
	options := clients.DeploymentOptions{
		Providers: &datamodel.Providers{},
	}

	var expectedConfig sdkclients.ProviderConfig

	expectedConfig.Radius = &sdkclients.Radius{
		Type: "Radius",
		Value: sdkclients.Value{
			Scope: "/planes/radius/local/resourceGroups/" + "testrg",
		},
	}
	expectedConfig.Deployments = &sdkclients.Deployments{
		Type: "Microsoft.Resources",
		Value: sdkclients.Value{
			Scope: "/planes/deployments/local/resourceGroups/" + "testrg",
		},
	}

	providerConfig := resourceDeploymentClient.GetProviderConfigs(options)
	require.Equal(t, providerConfig, expectedConfig)
}

//
// <AiDoc: The following comments were generated by OpenAI explaining the code as it existed at the time of this commit>
//	The previous function is creating a ResourceDeploymentClient object and setting the RadiusResourceGroup and AzProvider 
//	fields. It then creates an expectedProviderConfig object with the Az, Radius, and Deployments fields set to specific 
//	values. Finally, it calls the GetProviderConfigs() function on the ResourceDeploymentClient object and compares the 
//	result to the expectedProviderConfig object.
//
// </AiDoc: End of OpenAI comments>
func Test_GetProviderConfigsWithAzProvider(t *testing.T) {
	resourceDeploymentClient := ResourceDeploymentClient{
		RadiusResourceGroup: "testrg",
		Client:              &sdkclients.ResourceDeploymentsClient{},
		OperationsClient:    &sdkclients.ResourceDeploymentOperationsClient{},
	}

	options := clients.DeploymentOptions{
		Providers: &datamodel.Providers{
			Azure: datamodel.ProvidersAzure{
				Scope: "/subscriptions/dummy/resourceGroups/azrg",
			},
		},
	}

	var expectedConfig sdkclients.ProviderConfig

	expectedConfig.Az = &sdkclients.Az{
		Type: "AzureResourceManager",
		Value: sdkclients.Value{
			Scope: "/subscriptions/dummy/resourceGroups/" + "azrg",
		},
	}

	expectedConfig.Radius = &sdkclients.Radius{
		Type: "Radius",
		Value: sdkclients.Value{
			Scope: "/planes/radius/local/resourceGroups/" + "testrg",
		},
	}
	expectedConfig.Deployments = &sdkclients.Deployments{
		Type: "Microsoft.Resources",
		Value: sdkclients.Value{
			Scope: "/planes/deployments/local/resourceGroups/" + "testrg",
		},
	}

	providerConfig := resourceDeploymentClient.GetProviderConfigs(options)
	require.Equal(t, providerConfig, expectedConfig)
}
